<%- include('header') %>
<%- include('nav', { categories: categories, stores: stores }) %>	
  <div class="container mt-5 mb-5">

  <div class="row">
    <div class="col-md-4 order-md-2">
      <h4 class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-muted">Your cart</span>
        <span class="badge badge-secondary badge-pill" th:text="${books.size()}"></span>
      </h4>
      <ul class="list-group mb-3">
        <li class="list-group-item d-flex justify-content-between lh-condensed" th:each="book : ${books}">
          <div>
            <h6 class="my-0" th:text="${book.title}"></h6>
            <small class="text-muted" th:text="${book.publicationDate}"></small>
          </div>
          <span class="text-muted" th:text="${book.getPrice()}"></span>
        </li>
        <li class="list-group-item d-flex justify-content-between" id="total-li">
          <span>Total (Ft)</span>
          <strong th:text="${total}"></strong>
        </li>
      </ul>
    </div>
    <div class="col-md-8 order-md-1">
      <h4 class="mb-3">Order details</h4>
      <form class="needs-validation" method="post" action="/order">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="firstName">First name</label>
            <input type="text" class="form-control" id="firstName" value="<%= req.user.name.firstName %>"  required="" name="firstName" >
            <div class="invalid-feedback">
              Valid first name is required.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="lastName">Last name</label>
            <input type="text" class="form-control" id="lastName" value="<%= req.user.name.lastName %>"  required="" name="lastName" >
            <div class="invalid-feedback">
              Valid last name is required.
            </div>
          </div>
        </div>

		<div class="mb-3">
          	<label for="address">Billing/Shipping Address</label>
          	<input type="text" class="form-control" id="address1" value="<%= req.user.address %>" required="" name="address" >
          	<div class="invalid-feedback">
            	Please enter your shipping address.
          	</div>
        </div>
        <hr class="mb-4">
		<div class= "row">
			<div class="col-md-6 mb-3">
		        <h4 class="mb-3">Payment</h4>
		
		        <div class="d-block my-3">
		          <div class="custom-control custom-radio">
		            <input id="credit" name="paymentMethod" type="radio" class="custom-control-input" value="credit card" checked>
		            <label class="custom-control-label" for="credit">Credit card</label>
		          </div>
		          <div class="custom-control custom-radio">
		            <input id="cash" name="paymentMethod" type="radio" class="custom-control-input" value="cash">
		            <label class="custom-control-label" for="cash">Cash</label>
		          </div>
		        </div>
		    </div>
		    <div class="col-md-6 mb-3">
		        <h4 class="mb-3">Shipping</h4>
		
		        <div class="d-block my-3">
		          <div class="custom-control custom-radio">
		            <input id="store" name="shippingMethod" type="radio" class="custom-control-input" value="store" checked>
		            <label class="custom-control-label" for="store">Store pickup</label>
		          </div>
		          <div class="custom-control custom-radio">
		            <input id="home" name="shippingMethod" type="radio" class="custom-control-input" value="home delivery">
		            <label class="custom-control-label" for="home">Home delivery</label>
		          </div>
		        </div>
		    </div>
		</div>
		
		<hr class="mb-4">
		<div>
        	<h5>After ordering, you will receive a confirmation email on your email address!</h5>
        </div>
        <hr class="mb-4">
        <input type="hidden" id="total_price" th:value="${total}" name="total"></input>
        <button class="btn btn-primary btn-lg btn-block" type="submit">Order</button>
      </form>
    </div>
  </div>
</div>
	
<script src = "/js/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
	<script src = "/js/bootstrap.min.js"></script>
	<script src="/js/form-validation.js"></script>
	<script>
		var homeDelivery = false; 
		$('#home').click(function () {
			if ($(this).is(':checked')) {
				let priceInput = $('#total_price');
				if (!homeDelivery) {
					priceInput.val(parseFloat(priceInput.val())+1000);
					homeDelivery = true;
					$('#total-li').before(
						`<li class="list-group-item d-flex justify-content-between lh-condensed" id="delivery-li">
							<div>
					            <h6 class="my-0">Home Delivery</h6>
				          	</div>
			       			<span class="text-muted">1000.0</span>
					     </li>`
					);
					$('#total-li').children('strong').text(priceInput.val());
					
				}
			}
		});
		$('#store').click(function() {
			if ($(this).is(':checked')) {
				let priceInput = $('#total_price');
				if (homeDelivery) {
					priceInput.val(parseFloat(priceInput.val())-1000);
					homeDelivery = false;
					$('#delivery-li').remove();
					$('#total-li').children('strong').text(priceInput.val());
				}
			}
		});
	</script>
<%- include('footer') %>